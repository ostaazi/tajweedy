name: Prisma Migration

on:
  workflow_dispatch: {}   # Ø²Ø± "Run workflow" ÙŠØ¯ÙˆÙŠÙ‹Ø§
  # ØªØ³ØªØ·ÙŠØ¹ Ø¥Ø¶Ø§ÙØ© ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…Ø¹ ÙƒÙ„ Ø¯ÙØ¹ Ø¥Ù„Ù‰ main:
  # push:
  #   branches: [ main ]

permissions:
  contents: read

jobs:
  migrate:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ§¾ Checkout
        uses: actions/checkout@v4

      - name: ğŸŸ¢ Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'

      - name: ğŸ“¦ Install deps
        run: npm ci

      - name: ğŸ§¬ Prisma generate
        run: npx prisma generate

      - name: ğŸ—ƒï¸ Run Prisma migrate (deploy)
        env:
          DATABASE_URL: ${{ secrets.DATABASE_URL }}
        run: npx prisma migrate deploy
